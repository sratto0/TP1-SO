<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>view_lib.c</title>
  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>
<pre><code class = "cpp">
<a name="ln1">#include &quot;view_lib.h&quot;</a>
<a name="ln2">#include &lt;ncurses.h&gt;</a>
<a name="ln3"> </a>
<a name="ln4">int get_player_color(int player_id) {</a>
<a name="ln5">    // Asume que COLOR_PAIR_PLAYER1 es el primer valor consecutivo</a>
<a name="ln6">    return COLOR_PAIR_PLAYER1 + player_id;</a>
<a name="ln7">}</a>
<a name="ln8"> </a>
<a name="ln9">// Función para dibujar el tablero limpio</a>
<a name="ln10">void print_board_ncurses(game_t *game) {</a>
<a name="ln11">  clear();</a>
<a name="ln12"> </a>
<a name="ln13">  // Título del juego</a>
<a name="ln14">  attron(COLOR_PAIR(COLOR_PAIR_TITLE) | A_BOLD);</a>
<a name="ln15">  int title_x = (COLS - 20) / 2;</a>
<a name="ln16">  mvprintw(1, title_x, &quot;ChompChamps Board&quot;);</a>
<a name="ln17">  attroff(COLOR_PAIR(COLOR_PAIR_TITLE) | A_BOLD);</a>
<a name="ln18"> </a>
<a name="ln19">  // Calcular posición del tablero (centrado)</a>
<a name="ln20">  int board_start_y = 3;</a>
<a name="ln21">  int board_width = game-&gt;width * 4 + 1;</a>
<a name="ln22">  int board_start_x = (COLS - board_width) / 2;</a>
<a name="ln23"> </a>
<a name="ln24">  // Dibujar borde superior del tablero</a>
<a name="ln25">  attron(COLOR_PAIR(COLOR_PAIR_BOARD));</a>
<a name="ln26">  mvaddch(board_start_y, board_start_x, ACS_ULCORNER);</a>
<a name="ln27">  for (int j = 0; j &lt; game-&gt;width; j++) {</a>
<a name="ln28">    for (int k = 0; k &lt; 3; k++) {</a>
<a name="ln29">      mvaddch(board_start_y, board_start_x + 1 + j * 4 + k, ACS_HLINE);</a>
<a name="ln30">    }</a>
<a name="ln31">    if (j &lt; game-&gt;width - 1) {</a>
<a name="ln32">      mvaddch(board_start_y, board_start_x + 4 + j * 4, ACS_TTEE);</a>
<a name="ln33">    }</a>
<a name="ln34">  }</a>
<a name="ln35">  mvaddch(board_start_y, board_start_x + board_width - 1, ACS_URCORNER);</a>
<a name="ln36">  attroff(COLOR_PAIR(COLOR_PAIR_BOARD));</a>
<a name="ln37"> </a>
<a name="ln38">  // Dibujar filas del tablero</a>
<a name="ln39">  for (int i = 0; i &lt; game-&gt;height; i++) {</a>
<a name="ln40">    int row_y = board_start_y + 1 + i * 2;</a>
<a name="ln41"> </a>
<a name="ln42">    // Línea con contenido</a>
<a name="ln43">    attron(COLOR_PAIR(COLOR_PAIR_BOARD));</a>
<a name="ln44">    mvaddch(row_y, board_start_x, ACS_VLINE);</a>
<a name="ln45">    attroff(COLOR_PAIR(COLOR_PAIR_BOARD));</a>
<a name="ln46"> </a>
<a name="ln47">    for (int j = 0; j &lt; game-&gt;width; j++) {</a>
<a name="ln48">      int cell_value = game-&gt;board[i * game-&gt;width + j];</a>
<a name="ln49">      int cell_x = board_start_x + 1 + j * 4;</a>
<a name="ln50"> </a>
<a name="ln51">      // Verificar si hay un jugador en esta posición actual</a>
<a name="ln52">      bool current_player_here = false;</a>
<a name="ln53">      int current_player_id = -1;</a>
<a name="ln54">      for (unsigned int p = 0; p &lt; game-&gt;player_count; p++) {</a>
<a name="ln55">        if (game-&gt;players[p].x == j &amp;&amp; game-&gt;players[p].y == i) {</a>
<a name="ln56">          current_player_here = true;</a>
<a name="ln57">          current_player_id = p;</a>
<a name="ln58">          break;</a>
<a name="ln59">        }</a>
<a name="ln60">      }</a>
<a name="ln61"> </a>
<a name="ln62">      if (current_player_here) {</a>
<a name="ln63">        // Mostrar jugador actual</a>
<a name="ln64">        attron(COLOR_PAIR(get_player_color(current_player_id)) | A_BOLD);</a>
<a name="ln65">        mvprintw(row_y, cell_x, &quot;P%d&quot;, current_player_id);</a>
<a name="ln66">        attroff(COLOR_PAIR(get_player_color(current_player_id)) | A_BOLD);</a>
<a name="ln67">      } else if (cell_value &lt; 0) {</a>
<a name="ln68">        // Celda visitada por jugador (mostrar con color del jugador)</a>
<a name="ln69">        int player_id = -cell_value;</a>
<a name="ln70">        attron(COLOR_PAIR(get_player_color(player_id)));</a>
<a name="ln71">        mvprintw(row_y, cell_x, &quot;%d&quot;, (player_id)*-1);</a>
<a name="ln72">        attroff(COLOR_PAIR(get_player_color(player_id)));</a>
<a name="ln73">      } else if(cell_value == 0) {</a>
<a name="ln74">        attron(COLOR_PAIR(get_player_color(0)));</a>
<a name="ln75">        mvprintw(row_y, cell_x, &quot; 0&quot;);</a>
<a name="ln76">        attroff(COLOR_PAIR(get_player_color(0)));</a>
<a name="ln77">      } else {</a>
<a name="ln78">        // Celda con número</a>
<a name="ln79">        mvprintw(row_y, cell_x, &quot;%2d&quot;, cell_value);</a>
<a name="ln80">        attroff(COLOR_PAIR(COLOR_PAIR_NUMBER));</a>
<a name="ln81">      }</a>
<a name="ln82"> </a>
<a name="ln83">      // Borde vertical derecho de la celda</a>
<a name="ln84">      attron(COLOR_PAIR(COLOR_PAIR_BOARD));</a>
<a name="ln85">      mvaddch(row_y, board_start_x + 4 + j * 4, ACS_VLINE);</a>
<a name="ln86">      attroff(COLOR_PAIR(COLOR_PAIR_BOARD));</a>
<a name="ln87">    }</a>
<a name="ln88"> </a>
<a name="ln89">    // Línea separadora horizontal (excepto la última fila)</a>
<a name="ln90">    if (i &lt; game-&gt;height - 1) {</a>
<a name="ln91">      int sep_y = row_y + 1;</a>
<a name="ln92">      attron(COLOR_PAIR(COLOR_PAIR_BOARD));</a>
<a name="ln93">      mvaddch(sep_y, board_start_x, ACS_LTEE);</a>
<a name="ln94">      </a>
<a name="ln95">      for (int j = 0; j &lt; game-&gt;width; j++) {</a>
<a name="ln96">        for (int k = 0; k &lt; 3; k++) {</a>
<a name="ln97">          mvaddch(sep_y, board_start_x + 1 + j * 4 + k, ACS_HLINE);</a>
<a name="ln98">        }</a>
<a name="ln99">        if (j &lt; game-&gt;width - 1) {</a>
<a name="ln100">          mvaddch(sep_y, board_start_x + 4 + j * 4, ACS_PLUS);</a>
<a name="ln101">        }</a>
<a name="ln102">      }</a>
<a name="ln103">      </a>
<a name="ln104">      mvaddch(sep_y, board_start_x + board_width - 1, ACS_RTEE);</a>
<a name="ln105">      attroff(COLOR_PAIR(COLOR_PAIR_BOARD));</a>
<a name="ln106">    }</a>
<a name="ln107">  }</a>
<a name="ln108"> </a>
<a name="ln109">  // Borde inferior del tablero</a>
<a name="ln110">  int bottom_y = board_start_y + 1 + (game-&gt;height - 1) * 2 + 1;</a>
<a name="ln111">  attron(COLOR_PAIR(COLOR_PAIR_BOARD));</a>
<a name="ln112">  mvaddch(bottom_y, board_start_x, ACS_LLCORNER);</a>
<a name="ln113">  for (int j = 0; j &lt; game-&gt;width; j++) {</a>
<a name="ln114">    for (int k = 0; k &lt; 3; k++) {</a>
<a name="ln115">      mvaddch(bottom_y, board_start_x + 1 + j * 4 + k, ACS_HLINE);</a>
<a name="ln116">    }</a>
<a name="ln117">    if (j &lt; game-&gt;width - 1) {</a>
<a name="ln118">      mvaddch(bottom_y, board_start_x + 4 + j * 4, ACS_BTEE);</a>
<a name="ln119">    }</a>
<a name="ln120">  }</a>
<a name="ln121">  mvaddch(bottom_y, board_start_x + board_width - 1, ACS_LRCORNER);</a>
<a name="ln122">  attroff(COLOR_PAIR(COLOR_PAIR_BOARD));</a>
<a name="ln123"> </a>
<a name="ln124">  // Imprimir scoreboard debajo del tablero</a>
<a name="ln125">  print_scoreboard(game, bottom_y + 2);</a>
<a name="ln126"> </a>
<a name="ln127">  refresh();</a>
<a name="ln128">}</a>
<a name="ln129"> </a>
<a name="ln130">void print_scoreboard(game_t *game, int start_y) {</a>
<a name="ln131">    int score_start_x = 2;</a>
<a name="ln132">    </a>
<a name="ln133">    attron(COLOR_PAIR(COLOR_PAIR_TITLE) | A_BOLD);</a>
<a name="ln134">    mvprintw(start_y, score_start_x, &quot;=== SCOREBOARD ===&quot;);</a>
<a name="ln135">    attroff(COLOR_PAIR(COLOR_PAIR_TITLE) | A_BOLD);</a>
<a name="ln136">    </a>
<a name="ln137">    // Información de cada jugador</a>
<a name="ln138">    for (unsigned int i = 0; i &lt; game-&gt;player_count; i++) {</a>
<a name="ln139">        int y = start_y + 2 + i;</a>
<a name="ln140">        </a>
<a name="ln141">        // Color del jugador</a>
<a name="ln142">        attron(COLOR_PAIR(get_player_color(i)) | A_BOLD);</a>
<a name="ln143">        mvprintw(y, score_start_x, &quot;P%d&quot;, i);</a>
<a name="ln144">        attroff(COLOR_PAIR(get_player_color(i)) | A_BOLD);</a>
<a name="ln145">        </a>
<a name="ln146">        // Información del jugador</a>
<a name="ln147">        attron(COLOR_PAIR(COLOR_PAIR_INFO));</a>
<a name="ln148">        mvprintw(y, score_start_x + 4, &quot;Score: %3d  Valid: %2d  Invalid: %2d  [%s]&quot;,</a>
<a name="ln149">                 game-&gt;players[i].score,</a>
<a name="ln150">                 game-&gt;players[i].valid_requests,</a>
<a name="ln151">                 game-&gt;players[i].invalid_requests,</a>
<a name="ln152">                 game-&gt;players[i].blocked ? &quot;BLOCKED&quot; : &quot;ACTIVE&quot;);</a>
<a name="ln153">        attroff(COLOR_PAIR(COLOR_PAIR_INFO));</a>
<a name="ln154">    }</a>
<a name="ln155">    </a>
<a name="ln156">    // Información del juego</a>
<a name="ln157">    attron(COLOR_PAIR(COLOR_PAIR_INFO));</a>
<a name="ln158">    mvprintw(start_y + game-&gt;player_count + 4, score_start_x, </a>
<a name="ln159">             &quot;Board: %dx%d  |  Status: %s&quot;, </a>
<a name="ln160">             game-&gt;width, game-&gt;height,</a>
<a name="ln161">             game-&gt;finished ? &quot;FINISHED&quot; : &quot;PLAYING&quot;);</a>
<a name="ln162">    attroff(COLOR_PAIR(COLOR_PAIR_INFO));</a>
<a name="ln163">}</a>
<a name="ln164"> </a>
<a name="ln165">// void print_scoreboard_below_board(game_t *game, int start_y) {</a>
<a name="ln166">//     int score_start_x = 2;</a>
<a name="ln167">    </a>
<a name="ln168">//     attron(COLOR_PAIR(COLOR_PAIR_TITLE) | A_BOLD);</a>
<a name="ln169">//     mvprintw(start_y, score_start_x, &quot;=== SCOREBOARD ===&quot;);</a>
<a name="ln170">//     attroff(COLOR_PAIR(COLOR_PAIR_TITLE) | A_BOLD);</a>
<a name="ln171">    </a>
<a name="ln172">//     // Información de cada jugador</a>
<a name="ln173">//     for (unsigned int i = 0; i &lt; game-&gt;player_count; i++) {</a>
<a name="ln174">//         int y = start_y + 2 + i;</a>
<a name="ln175">        </a>
<a name="ln176">//         // Color del jugador</a>
<a name="ln177">//         attron(COLOR_PAIR(get_player_color(i)) | A_BOLD);</a>
<a name="ln178">//         mvprintw(y, score_start_x, &quot;P%d&quot;, i);</a>
<a name="ln179">//         attroff(COLOR_PAIR(get_player_color(i)) | A_BOLD);</a>
<a name="ln180">        </a>
<a name="ln181">//         // Información del jugador</a>
<a name="ln182">//         attron(COLOR_PAIR(COLOR_PAIR_INFO));</a>
<a name="ln183">//         mvprintw(y, score_start_x + 4, &quot;Score: %3d  Valid: %2d  Invalid: %2d  [%s]&quot;,</a>
<a name="ln184">//                  game-&gt;players[i].score,</a>
<a name="ln185">//                  game-&gt;players[i].valid_requests,</a>
<a name="ln186">//                  game-&gt;players[i].invalid_requests,</a>
<a name="ln187">//                  game-&gt;players[i].blocked ? &quot;BLOCKED&quot; : &quot;ACTIVE&quot;);</a>
<a name="ln188">//         attroff(COLOR_PAIR(COLOR_PAIR_INFO));</a>
<a name="ln189">//     }</a>
<a name="ln190">//   }</a>
<a name="ln191">// //     // Información del juego</a>
<a name="ln192">// //     attron(COLOR_PAIR(COLOR_PAIR_INFO));</a>
<a name="ln193">// //     mvprintw(start_y + game-&gt;player_count + 4, score_start_x, </a>
<a name="ln194">// //              &quot;Board: %dx%d  |  Status: %s&quot;, </a>
<a name="ln195">// //              game-&gt;width, game-&gt;height,</a>
<a name="ln196">// //              game-&gt;finished ? &quot;FINISHED&quot; : &quot;PLAYING&quot;);</a>
<a name="ln197">// //     attroff(COLOR_PAIR(COLOR_PAIR_INFO));</a>
<a name="ln198">// // }</a>
</code></pre>
<div class="balloon" rel="1"><p><span style="font-size:18px">&uarr;</span> <a href="https://pvs-studio.com/en/docs/warnings/v009/" target="_blank">V009</a> To use free version of PVS-Studio, source code files are required to start with a special comment.</p></div>
<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>